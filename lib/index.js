"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var React=_interopDefault(require("react"));function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),n.forEach(function(e){_defineProperty(t,e,a[e])})}return t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _isExist(e){for(var t=arguments,a=0;a<t.length;a++){var n=t[a];if(""===n||null==n)return!1}return!0}function _getRate(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return _isExist(e,t)&&0<=e&&0<t?e/t:0}function _getMax(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"key",n=[];return e.map(function(e,t){isNaN(e[a])||n.push(e[a])}),0<n.length?Math.max.apply(null,n):0}function _getCtx(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"2d";return _isExist(e)&&this.refs[e]&&this.refs[e].getContext(t)}function DrawCoordinate(){var C=[0,0],P=[100,100];function R(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:C,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:P,a=e[0]!==t[0]&&e[1]===t[1],n=e[0]===t[0]&&e[1]!==t[1];return{drawX:a,drawY:n,flag:a||n}}this._drawCoor=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=t.show,n=t.begin,i=void 0===n?C:n,r=t.end,o=void 0===r?P:r,l=t.strokeStyle,s=void 0===l?"#000":l,d=t.lineWidth,c=void 0===d?3:d,h=t.lineCap,u=void 0===h?"round":h,p=t.setLineDash,f=R(i,o).flag;a&&f&&(e.save(),e.beginPath(),Array.isArray(p)&&2===p.length&&e.setLineDash(p),e.moveTo.apply(e,i),e.lineTo.apply(e,o),e.strokeStyle=s,e.lineWidth=c,e.lineCap=u,e.stroke(),e.restore())},this._drawScale=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=t.begin,n=void 0===a?C:a,i=t.end,r=void 0===i?P:i,o=t.strokeStyle,l=void 0===o?"#000":o,s=t.scaleNum,d=void 0===s?5:s,c=t.scaleLength,h=void 0===c?0:c,u=R(n,r),p=u.drawX,f=u.drawY;if(u.flag&&0<d){var v,g,y,_,w=(r[0]-n[0])/(d-1),b=(r[1]-n[1])/(d-1);e.save();for(var m=0;m<d;m++)y=(v=n[0]+w*m)+(f?h:0),_=(g=n[1]+b*m)+(p?h:0),e.beginPath(),e.moveTo(v,g),e.lineTo(y,_),e.strokeStyle=l,e.stroke();e.restore()}},this._drawGrid=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=t.begin,n=void 0===a?C:a,i=t.end,r=void 0===i?P:i,o=t.gridNum,l=void 0===o?5:o,s=t.strokeStyle,d=void 0===s?"#000":s,c=t.setLineDash,h=void 0===c?[4,4]:c,u=t.gridLength,p=R(n,r),f=p.drawX,v=p.drawY;if(p.flag&&0<l){var g,y,_,w,b=(r[0]-n[0])/(l-1),m=(r[1]-n[1])/(l-1);e.save();for(var k=1;k<l;k++)_=(g=n[0]+b*k)+(v?u:0),w=(y=n[1]+m*k)+(f?u:0),e.beginPath(),Array.isArray(h)&&2===h.length&&e.setLineDash(h),e.moveTo(g,y),e.lineTo(_,w),e.strokeStyle=d,e.stroke();e.restore()}},this._drawLabel=function(e){var t,a,n,i,r,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},l=o.key,s=(o.label,o.labelNum),d=void 0===s?2:s,c=o.begin,h=void 0===c?C:c,u=o.end,p=void 0===u?P:u,f=o.data,v=void 0===f?[]:f,g=R(h,p),y=g.drawX,_=g.drawY,w=v.length;if(e.save(),y){t=(p[0]-h[0])/(w-1),a=(p[1]-h[1])/(w-1);for(var b=0;b<w;b++)n=h[0]+t*b,i=h[1]+a*b,r=v[b][l],e.textAlign="center",e.textBaseline="top",e.fillText(isNaN(r)?r:Math.round(r),n,i+5)}else if(_){for(var m,k,x=0,L=0;L<l.length;L++)x=Math.max(x,_getMax(v,l[L]));m=x/(d-1),t=(p[0]-h[0])/(d-1),k=(p[1]-h[1])/(d-1);for(var S=r=0;S<d;S++)n=h[0]+t*S,i=h[1]+k*S,e.textAlign="end",e.textBaseline="middle",e.fillText(isNaN(r)?r:Math.round(r),n-5,i),r+=m}else e.restore()}}var DrawLine=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e))}return _inherits(t,DrawCoordinate),_createClass(t,[{key:"_drawData",value:function(r){for(var o,l,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t=e.data,a=void 0===t?[]:t,n=e.key,i=void 0===n?[]:n,s=e.xCoor,d=e.yCoor,c=e.strokeStyle,h=void 0===c?[]:c,u=e.lineWidth,p=void 0===u?3:u,f=(s.end[0]-s.begin[0])/(a.length-1),v=d.end[1]-d.begin[1],g=0,y=0;y<i.length;y++)g=Math.max(g,_getMax(a,i[y]));i.map(function(n,e){r.beginPath(),a.map(function(e,t){var a=e[n];o=s.begin[0]+f*t,l=_getRate(a,g)*v+d.begin[1],0===t&&r.moveTo(o,l),0<t&&r.lineTo(o,l)}),r.strokeStyle=h[e%h.length],r.lineWidth=p,r.stroke()}),i.map(function(n,i){a.map(function(e,t){var a=e[n];o=s.begin[0]+f*t,l=_getRate(a,g)*v+d.begin[1],r.beginPath(),r.arc(o,l,5,0,2*Math.PI),r.fillStyle=h[i%h.length],r.fill()})})}}]),t}();function _drawLine(){return new DrawLine}function styleInject(e,t){void 0===t&&(t={});var a=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===a&&n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}var css=".radar_area {\n  position: relative;\n  width: 400px;\n  height: 400px;\n}\n.radar_canvas {\n  position: absolute;\n  top: 0;\n  left: 0;\n  border: 1px solid #000;\n}\n";styleInject(css);var Radar=function(e){function a(e){var t;return _classCallCheck(this,a),(t=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,e))).state={canvasId:["back","data"],lengthLimit:3,center:{},props:{}},t}return _inherits(a,React.Component),_createClass(a,[{key:"componentDidMount",value:function(){var e=this;this.setState({props:this.props},function(){return e.init()})}},{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({props:e},function(){return t.init()})}},{key:"init",value:function(){var e=this,t=this.state.canvasId,a=this.state.props,n=a.width,i=a.height,r=_getCtx.call(this,t[0]),o={x:Math.round(n/2),y:Math.round(i/2)};this.setState({center:o},function(){e.drawBack(r)})}},{key:"drwaCenterDot",value:function(e){var t=this.state.center;e.save(),e.beginPath(),e.translate(t.x,t.y),e.arc(0,0,3,0,2*Math.PI),e.fillStyle="#000",e.fill(),e.stroke(),e.restore()}},{key:"drawRadar",value:function(e,t){var a,n,i=this.state.center,r=this.state.props,o=r.data,l=(r.width,r.height,r.radius),s=r.scaleLine,d=r.guideLine,c=s.lineWidth,h=s.lineColor,u=d.print,p=2*Math.PI/o.length,f=[],v=[],g=l<=t;e.save(),e.beginPath(),e.translate(i.x,i.y),e.moveTo(0,-t);for(var y=0;y<o.length;y++)a=-t*Math.sin(p*y),n=-t*Math.cos(p*y),this.drawLine(e,a,n),g&&(this.drawLabel(e,a,n,o[y]),f.push({x:a,y:n}),v.push({x:a,y:n,item:o[y]}));e.lineWidth=c,e.strokeStyle=h,e.closePath(),e.stroke(),e.restore(),g&&u&&this.drawGuideLine(e,f),g&&this.drawData(v)}},{key:"drawLine",value:function(e,t,a){e.lineTo(t,a)}},{key:"drawLabel",value:function(e,t,a,n){var i=this.state.props,r=(i.data,i.labelRender),o=r.label,l=(r.value,r.color),s=r.textGap,d=r.defaultColor,c=r.font,h=r.render;o=n[o]||"",l=n[l]||d,0<(t=Math.round(t))?t+=s:t<0&&(t-=s),0<(a=Math.round(a))?a+=s:a<0&&(a-=s),e.font=c,e.textAlign="center",e.textBaseline="middle",e.fillStyle=l,e.fillText("function"==typeof h&&h(n,r)?h(n,r):o,t,a)}},{key:"drawGuideLine",value:function(e,t){for(var a=this.state.center,n=this.state.props.guideLine,i=(n.dash,n.setLineDash),r=n.strokeStyle,o=n.lineWidth,l=0;l<t.length;l++)e.save(),e.beginPath(),e.translate(a.x,a.y),i&&0<i.length&&e.setLineDash(i),e.moveTo(0,0),e.lineTo(t[l].x,t[l].y),e.lineWidth=o,e.strokeStyle=r,e.stroke(),e.restore()}},{key:"drawData",value:function(e){var t=this.state,a=t.canvasId,n=t.center,i=this.state.props,r=i.data,o=i.labelRender,l=i.dataRender,s=o.value,d=l.dash,c=l.strokeStyle,h=l.lineWidth,u=l.fillStyle,p=l.setLineDash,f=_getCtx.call(this,a[1]),v=_getMax(r,s);f.save(),f.beginPath(),f.translate(n.x,n.y),f.moveTo(e[0].x*_getRate(e[0].item[s],v),e[0].y*_getRate(e[0].item[s],v));for(var g=0;g<e.length;g++)f.lineTo(e[g].x*_getRate(e[g].item[s],v),e[g].y*_getRate(e[g].item[s],v));f.closePath(),d&&f.setLineDash(p),c&&(f.strokeStyle=c,f.lineWidth=h,f.stroke()),u&&(f.fillStyle=u,f.fill()),f.restore()}},{key:"drawBack",value:function(e){var t=this.state.lengthLimit,a=this.state.props,n=a.data,i=a.width,r=a.height,o=a.radius,l=(a.lineWidth,a.scaleLine.gridNum);if(e.clearRect(0,0,i,r),n.length>=t){for(var s=0;s<l;s++)this.drawRadar(e,o-o/l*s);this.drwaCenterDot(e)}}},{key:"render",value:function(){var e=this.state.canvasId,t=this.state.props,a=t.width,n=t.height;return React.createElement("div",{className:"radar_area"},e&&e.map(function(e,t){return React.createElement("canvas",{key:e,ref:e,width:a,height:n,className:"radar_canvas"})}))}}]),a}();Radar.defaultProps={width:400,height:400,radius:120,scaleLine:{lineWidth:3,lineColor:"#5d9cec",gridNum:3},guideLine:{print:!0,setLineDash:[5,5],lineWidth:2,strokeStyle:"#5d9"},labelRender:{label:"name",value:"score",color:"color",textGap:15,defaultColor:"#000",font:"16px Arial",render:function(e,t){return"".concat(e[t.label]||"").concat(isNaN(e[t.value])?"":"("+e[t.value]+")")}},dataRender:{dash:!1,setLineDash:[2,2],strokeStyle:"#000",lineWidth:1,fillStyle:"rgba(225, 225, 0, .9)"},data:[{name:"A",score:120,color:"aqua"},{name:"B",score:60,color:"red"},{name:"C",score:60},{name:"D",score:60,color:"blue"},{name:"E",score:60,color:"green"},{name:"F",score:60,color:"yellow"},{name:"G",score:60},{name:"H",score:60}]};var css$1=".line_all {\n  position: relative;\n}\n.line_canvas {\n  position: absolute;\n  top: 0;\n  left: 0;\n  border: 1px solid #000;\n}\n.line_tooltip {\n  position: absolute;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-wrap: nowrap;\n}\n.line_tooltip > div {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-wrap: nowrap;\n  font-size: 14px;\n}\n.line_tooltip > div:not(last-child) {\n  margin-right: 10px;\n}\n";styleInject(css$1);var _drawLine2=_drawLine(),_drawCoor=_drawLine2._drawCoor,_drawScale=_drawLine2._drawScale,_drawGrid=_drawLine2._drawGrid,_drawLabel=_drawLine2._drawLabel,_drawData=_drawLine2._drawData,Line=function(e){function a(e){var t;return _classCallCheck(this,a),(t=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,e))).state={canvasId:["back"],tooltipDOM:void 0,initScale:[],props:{}},t}return _inherits(a,React.Component),_createClass(a,[{key:"getPosition",value:function(){var e=this.state.props.innerGap;return{top:e[0],right:e[1],bottom:e[2],left:e[3]}}},{key:"componentDidMount",value:function(){var e=this;this.setState({props:this.props},function(){return e.init()})}},{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({props:e},function(){return t.init()})}},{key:"init",value:function(){var e=this,t=this.state.canvasId,a=this.state.props,n=(a.width,a.height),i=this.getPosition(),r=(i.top,i.right,i.bottom),o=i.left,l=_getCtx.call(this,t[0]);_getCtx.call(this,t[1]);this.setState({initScale:[o,n-r]},function(){e.drawBack(l),e.drawTooltip()})}},{key:"drawBack",value:function(e){var t=this.state.initScale,a=this.state.props,n=a.width,i=a.height,r=a.axisX,o=a.axisY,l=a.scaleX,s=a.scaleY,d=a.gridX,c=a.gridY,h=a.labelX,u=a.labelY,p=a.dataLine,f=a.data,v=this.getPosition(),g=v.top,y={begin:t,end:[n-v.right,i-v.bottom]},_={begin:t,end:[v.left,g]};_drawCoor(e,_objectSpread({},r,y)),_drawCoor(e,_objectSpread({},o,_)),_drawScale(e,_objectSpread({},r,y,l,{scaleNum:f.length})),_drawScale(e,_objectSpread({},o,_,s)),_drawGrid(e,_objectSpread({},r,y,d,{gridNum:f.length,gridLength:_.end[1]-_.begin[1]})),_drawGrid(e,_objectSpread({},o,_,c,{gridLength:y.end[0]-y.begin[0]})),_drawLabel(e,_objectSpread({},h,y,{data:f})),_drawLabel(e,_objectSpread({},u,_,{data:f})),_drawData(e,_objectSpread({key:u.key,data:f,xCoor:y,yCoor:_},p))}},{key:"drawTooltip",value:function(){var e=this.state.props,t=e.width,a=e.tooltip,n=e.labelY,i=e.dataLine,r=a.position,o=a.height,l=a.childLineHeight,s=a.childLineWidth,d=n.key,c=n.label,h={height:o,width:t};h[r]=0;var u=React.createElement("div",{className:"line_tooltip",style:h},d.map(function(e,t){return React.createElement("div",null,React.createElement("div",{style:{height:l,width:s,marginRight:5,background:i.strokeStyle[t%i.strokeStyle.length]}}),React.createElement("div",null,c[t]||e))}));this.setState({tooltipDOM:u})}},{key:"render",value:function(){var e=this.state,t=e.canvasId,a=e.tooltipDOM,n=this.state.props,i=n.width,r=n.height;n.coordinate;return React.createElement("div",{className:"line_all",style:{width:i,height:r}},t&&t.map(function(e,t){return React.createElement("canvas",{key:e,ref:e,width:i,height:r,className:"line_canvas"})}),a)}}]),a}();Line.defaultProps={width:1e3,height:500,innerGap:[40,40,80,40],axisX:{show:!0,strokeStyle:"#5d9cec",lineWidth:2,setLineDash:[]},axisY:{show:!0,strokeStyle:"#5d9cec",lineWidth:2,setLineDash:[]},scaleX:{scaleLength:0},scaleY:{scaleNum:5,scaleLength:0},gridX:{strokeStyle:"#000",setLineDash:[4,4]},gridY:{gridNum:5,strokeStyle:"#000",setLineDash:[4,4]},labelX:{key:"x",label:"日期"},labelY:{key:["weight","IQ","EQ"],label:["体重","智商","情商"],labelNum:5},dataLine:{strokeStyle:["red","green","blue"],lineWidth:3},tooltip:{position:"bottom",height:60,childLineHeight:5,childLineWidth:40},data:[{x:"2012-12-12",weight:0,IQ:300,EQ:250},{x:"2012-12-13",weight:100,IQ:200,EQ:125},{x:"2012-12-14",weight:200,IQ:100,EQ:250},{x:"2012-12-15",weight:300,IQ:0,EQ:125},{x:"2012-12-16",weight:200,IQ:100,EQ:250},{x:"2012-12-17",weight:100,IQ:200,EQ:120},{x:"2012-12-18",weight:0,IQ:300,EQ:250}]},exports.Line=Line,exports.Radar=Radar;
