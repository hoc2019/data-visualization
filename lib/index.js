"use strict";function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}Object.defineProperty(exports,"__esModule",{value:!0});var React=_interopDefault(require("react"));function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,a){return e&&_defineProperties(t.prototype,e),a&&_defineProperties(t,a),t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _possibleConstructorReturn(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?_assertThisInitialized(t):e}function _getCtx(t){return this.refs[t]&&this.refs[t].getContext("2d")}function _getRate(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return!isNaN(t)&&!isNaN(e)&&0<=t&&0<=e?t/e:0}function _getMax(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"key",n=[];return t.map(function(t,e){isNaN(t[a])||n.push(t[a])}),0<n.length?Math.max.apply(null,n):0}function styleInject(t,e){void 0===e&&(e={});var a=e.insertAt;if(t&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===a&&n.firstChild?n.insertBefore(i,n.firstChild):n.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}}var css=".radar_area {\n  position: relative;\n  width: 400px;\n  height: 400px;\n}\n.radar_canvas {\n  position: absolute;\n  top: 0;\n  left: 0;\n  border: 1px solid #000;\n}\n";styleInject(css);var Radar=function(t){function a(t){var e;return _classCallCheck(this,a),(e=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,t))).state={canvasId:["back","data"],lengthLimit:3,center:{},props:{}},e}return _inherits(a,React.Component),_createClass(a,[{key:"componentDidMount",value:function(){var t=this;this.setState({props:this.props},function(){return t.init()})}},{key:"componentWillReceiveProps",value:function(t){var e=this;this.setState({props:t},function(){return e.init()})}},{key:"init",value:function(){var t=this,e=this.state.canvasId,a=this.state.props,n=a.width,i=a.height,r=_getCtx.call(this,e[0]),o={x:Math.round(n/2),y:Math.round(i/2)};this.setState({center:o},function(){t.drawBack(r)})}},{key:"drwaCenterDot",value:function(t){var e=this.state.center;t.save(),t.beginPath(),t.translate(e.x,e.y),t.arc(0,0,3,0,2*Math.PI),t.fillStyle="#000",t.fill(),t.stroke(),t.restore()}},{key:"drawRadar",value:function(t,e){var a,n,i=this.state.center,r=this.state.props,o=r.data,s=(r.width,r.height,r.radius),l=r.scaleLine,h=r.guideLine,c=l.lineWidth,d=l.lineColor,u=h.print,p=2*Math.PI/o.length,f=[],g=[],y=s<=e;t.save(),t.beginPath(),t.translate(i.x,i.y),t.moveTo(0,-e);for(var v=0;v<o.length;v++)a=-e*Math.sin(p*v),n=-e*Math.cos(p*v),this.drawLine(t,a,n),y&&(this.drawLabel(t,a,n,o[v]),f.push({x:a,y:n}),g.push({x:a,y:n,item:o[v]}));t.lineWidth=c,t.strokeStyle=d,t.closePath(),t.stroke(),t.restore(),y&&u&&this.drawGuideLine(t,f),y&&this.drawData(g)}},{key:"drawLine",value:function(t,e,a){t.lineTo(e,a)}},{key:"drawLabel",value:function(t,e,a,n){var i=this.state.props,r=(i.data,i.labelRender),o=r.label,s=(r.value,r.color),l=r.textGap,h=r.defaultColor,c=r.font,d=r.render;o=n[o]||"",s=n[s]||h,0<(e=Math.round(e))?e+=l:e<0&&(e-=l),0<(a=Math.round(a))?a+=l:a<0&&(a-=l),t.font=c,t.textAlign="center",t.textBaseline="middle",t.fillStyle=s,t.fillText("function"==typeof d&&d(n,r)?d(n,r):o,e,a)}},{key:"drawGuideLine",value:function(t,e){for(var a=this.state.center,n=this.state.props.guideLine,i=(n.dash,n.setLineDash),r=n.strokeStyle,o=n.lineWidth,s=0;s<e.length;s++)t.save(),t.beginPath(),t.translate(a.x,a.y),i&&0<i.length&&t.setLineDash(i),t.moveTo(0,0),t.lineTo(e[s].x,e[s].y),t.lineWidth=o,t.strokeStyle=r,t.stroke(),t.restore()}},{key:"drawData",value:function(t){var e=this.state,a=e.canvasId,n=e.center,i=this.state.props,r=i.data,o=i.labelRender,s=i.dataRender,l=o.value,h=s.dash,c=s.strokeStyle,d=s.lineWidth,u=s.fillStyle,p=s.setLineDash,f=_getCtx.call(this,a[1]),g=_getMax(r,l);f.save(),f.beginPath(),f.translate(n.x,n.y),f.moveTo(t[0].x*_getRate(t[0].item[l],g),t[0].y*_getRate(t[0].item[l],g));for(var y=0;y<t.length;y++)f.lineTo(t[y].x*_getRate(t[y].item[l],g),t[y].y*_getRate(t[y].item[l],g));f.closePath(),h&&f.setLineDash(p),c&&(f.strokeStyle=c,f.lineWidth=d,f.stroke()),u&&(f.fillStyle=u,f.fill()),f.restore()}},{key:"drawBack",value:function(t){var e=this.state.lengthLimit,a=this.state.props,n=a.data,i=a.width,r=a.height,o=a.radius,s=(a.lineWidth,a.scaleLine.gridNum);if(t.clearRect(0,0,i,r),n.length>=e){for(var l=0;l<s;l++)this.drawRadar(t,o-o/s*l);this.drwaCenterDot(t)}}},{key:"render",value:function(){var t=this.state.canvasId,e=this.state.props,a=e.width,n=e.height;return React.createElement("div",{className:"radar_area"},t&&t.map(function(t,e){return React.createElement("canvas",{key:t,ref:t,width:a,height:n,className:"radar_canvas"})}))}}]),a}();Radar.defaultProps={width:400,height:400,radius:120,scaleLine:{lineWidth:3,lineColor:"#5d9cec",gridNum:3},guideLine:{print:!0,setLineDash:[5,5],lineWidth:2,strokeStyle:"#5d9"},labelRender:{label:"name",value:"score",color:"color",textGap:15,defaultColor:"#000",font:"16px Arial",render:function(t,e){return"".concat(t[e.label]||"").concat(isNaN(t[e.value])?"":"("+t[e.value]+")")}},dataRender:{dash:!1,setLineDash:[2,2],strokeStyle:"#000",lineWidth:1,fillStyle:"rgba(225, 225, 0, .9)"},data:[{name:"A",score:120,color:"aqua"},{name:"B",score:60,color:"red"},{name:"C",score:60},{name:"D",score:60,color:"blue"},{name:"E",score:60,color:"green"},{name:"F",score:60,color:"yellow"},{name:"G",score:60},{name:"H",score:60}]};var css$1=".line_all {\n  position: relative;\n}\n.line_canvas {\n  position: absolute;\n  top: 0;\n  left: 0;\n  border: 1px solid #000;\n}\n.line_tooltip {\n  position: absolute;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-wrap: nowrap;\n}\n.line_tooltip > div {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-wrap: nowrap;\n  font-size: 14px;\n}\n.line_tooltip > div:not(last-child) {\n  margin-right: 10px;\n}\n";styleInject(css$1);var Line=function(t){function a(t){var e;return _classCallCheck(this,a),(e=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,t))).state={canvasId:["back"],tooltipDOM:void 0,initScale:[],props:{}},e}return _inherits(a,React.Component),_createClass(a,[{key:"getPosition",value:function(){var t=this.state.props.innerGap;return{top:t[0],right:t[1],bottom:t[2],left:t[3]}}},{key:"componentDidMount",value:function(){var t=this;this.setState({props:this.props},function(){return t.init()})}},{key:"componentWillReceiveProps",value:function(t){var e=this;this.setState({props:t},function(){return e.init()})}},{key:"init",value:function(){var t=this,e=this.state.canvasId,a=this.state.props,n=(a.width,a.height),i=this.getPosition(),r=(i.top,i.right,i.bottom),o=i.left,s=_getCtx.call(this,e[0]),l=(_getCtx.call(this,e[1]),[o,n-r]);this.setState({initScale:l},function(){t.drawBack(s),t.drawTooltip()})}},{key:"drawBack",value:function(t){var e=this.drawCoorX(t),a=this.drawCoorY(t);this.drawBackContent(t,e),this.drawBackContent(t,a)}},{key:"drawCoorX",value:function(t){var e=this.state.initScale,a=this.state.props,n=a.width,i=a.height,r=a.coordinate,o=r.lineWidth,s=r.axisX,l=s.arrow,h=s.show,c=s.setLineDash,d=this.getPosition(),u=(d.top,d.right),p=d.bottom;d.left;return h&&(t.save(),t.beginPath(),c&&0<c.length&&t.setLineDash(c),t.moveTo.apply(t,e),t.lineTo(n-u,i-p),l&&(t.lineTo(n-u-arrowLength*Math.cos(arrowAngle),i-p-arrowLength*Math.sin(arrowAngle)),t.moveTo(n-u,i-p),t.lineTo(n-u-arrowLength*Math.cos(arrowAngle),i-p+arrowLength*Math.sin(arrowAngle))),t.lineWidth=o,t.stroke(),t.restore()),{type:"axisX",begin:{x:e[0],y:e[1]},end:{x:n-u,y:i-p},getLength:function(){return Math.abs(this.end.x-this.begin.x)}}}},{key:"drawCoorY",value:function(t){var e=this.state.initScale,a=this.state.props,n=(a.width,a.height,a.coordinate),i=n.lineWidth,r=n.axisY,o=r.arrow,s=r.show,l=r.setLineDash,h=this.getPosition(),c=h.top,d=(h.right,h.bottom,h.left);return s&&(t.save(),t.beginPath(),l&&0<l.length&&t.setLineDash(l),t.moveTo.apply(t,e),t.lineTo(d,c),o&&(t.lineTo(d-arrowLength*Math.sin(arrowAngle),c+arrowLength*Math.cos(arrowAngle)),t.moveTo(d,c),t.lineTo(d+arrowLength*Math.sin(arrowAngle),c+arrowLength*Math.cos(arrowAngle))),t.lineWidth=i,t.stroke(),t.restore()),{type:"axisY",begin:{x:e[0],y:e[1]},end:{x:d,y:c},getLength:function(){return Math.abs(this.end.y-this.begin.y)}}}},{key:"drawTooltip",value:function(t){var e=this.state.tooltipDOM,a=this.state.props,n=a.width,i=a.tooltip,r=(a.coordinate,a.data),o=r.axisY,s=r.line,l=(r.dot,o.key),h=o.label,c={width:n,height:this.getPosition()[i.position]-12};c[i.position]=0,e=React.createElement("div",{className:"line_tooltip",style:c},l.map(function(t,e){return React.createElement("div",null,React.createElement("div",{style:{height:i.height,width:i.width,marginRight:5,background:s.strokeStyle[e%s.strokeStyle.length]}}),React.createElement("div",null,h[e]||t))})),this.setState({tooltipDOM:e})}},{key:"drawBackContent",value:function(e,t){var i,r,o=this,a=this.state.props,n=a.width,s=(a.height,a.coordinate),l=a.data,h=s.scaleLength,c=s.scaleNum,d=t.type,u=t.begin,p=(t.end,this.getPosition()),f=p.top,g=p.right,y=(p.bottom,p.left,l.sourceKey),v=(l.axisX,l.axisY),w=t.getLength();if(h=isNaN(h)?0:h,"axisX"===d){var m=[];w/=l[y].length-1,l[y].map(function(a,t){i=u.x+w*t,r=u.y,o.drawGrid(e,d,[i,r],[i,f]),o.drawScale(e,[i,r],[i,r+h],t),o.drawLabel(e,l[y][t][l.axisX.key],i,r+5,{textAlign:"center",textBaseline:"top"});var n={};v.key.map(function(t,e){n[t]=a[t]}),n.x=i,m.push(n)}),this.drawData(e,m)}if("axisY"===d){w/=c-1;var x=0;v.key.map(function(t,e){x=Math.max(x,_getMax(l[y],t))});for(var k=0;k<c;k++)i=u.x,r=u.y-w*k,this.drawGrid(e,d,[i,r],[n-g,r]),this.drawScale(e,[i,r],[i-h,r],k),this.drawLabel(e,x/(c-1)*k,i-5,r,{textAlign:"end",textBaseline:"middle"})}}},{key:"drawScale",value:function(t,e,a,n){0<n&&(t.save(),t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,a),t.stroke(),t.restore())}},{key:"drawLabel",value:function(t,e,a,n,i){var r=i.textAlign,o=i.textBaseline;t.save(),t.textAlign=r,t.textBaseline=o,t.fillText(isNaN(e)?e:Math.round(e),a,n),t.restore()}},{key:"drawGrid",value:function(t,e,a,n){var i=this.state.props.coordinate[e].grid||{},r=i.show,o=i.setLineDash;r&&(t.save(),t.beginPath(),o&&0<o.length&&t.setLineDash(o),t.moveTo.apply(t,a),t.lineTo.apply(t,n),t.stroke(),t.restore())}},{key:"drawData",value:function(s){var l=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],t=(this.state.initScale,this.state.props),h=t.height,a=t.data,n=a.sourceKey,i=(a.lineWidth,a.line),e=a.dot,r=a.axisY,o=this.getPosition(),c=o.top,d=(o.left,o.right,o.bottom),u=0;r.key.map(function(t,e){u=Math.max(u,_getMax(a[n],t))}),i&&i.show&&r.key.map(function(n,t){var e=i.lineWidth,a=i.strokeStyle;s.save(),s.beginPath(),l.map(function(t,e){var a=[t.x,c+(h-c-d)*(1-t[n]/u)];0===e&&s.moveTo.apply(s,a),0<e&&s.lineTo.apply(s,a)}),s.lineWidth=e,s.strokeStyle=a[t%a.length],s.stroke(),s.restore()}),e&&e.show&&r.key.map(function(n,i){var r=e.radius,o=e.fillStyle;s.save(),l.map(function(t,e){var a=[t.x,c+(h-c-d)*(1-t[n]/u)];s.beginPath(),s.arc(a[0],a[1],r,0,2*Math.PI),s.fillStyle=o[i%o.length],s.fill()}),s.restore()})}},{key:"render",value:function(){var t=this.state,e=t.canvasId,a=t.tooltipDOM,n=this.state.props,i=n.width,r=n.height;n.coordinate;return React.createElement("div",{className:"line_all",style:{width:i,height:r}},e&&e.map(function(t,e){return React.createElement("canvas",{key:t,ref:t,width:i,height:r,className:"line_canvas"})}),a)}}]),a}();Line.defaultProps={width:800,height:400,innerGap:[40,40,60,40],coordinate:{axisX:{show:!0,arrow:!1,setLineDash:[],grid:{show:!0,setLineDash:[2,2]}},axisY:{show:!0,arrow:!1,setLineDash:[],grid:{show:!0,setLineDash:[2,2]}},arrowAngle:Math.PI/6,arrowLength:15,lineWidth:1,scaleLength:0,scaleNum:6},tooltip:{position:"bottom",width:40,height:4},data:{axisX:{key:"x",label:"日期"},axisY:{key:["num","y","ht"],label:["体重","IQ","EQ"]},line:{show:!0,lineWidth:2,strokeStyle:["red","#5d9","blue"]},dot:{show:!0,radius:4,fillStyle:["red","#5d9","blue"]},sourceKey:"source",source:[{x:"2012-12-12",num:400,y:150,ht:250},{x:"2012-12-13",num:180,y:100,ht:125},{x:"2012-12-14",num:130,y:150,ht:250},{x:"2012-12-15",num:80,y:80,ht:125},{x:"2012-12-16",num:150,y:120,ht:250},{x:"2012-12-17",num:300,y:200,ht:125},{x:"2012-12-18",num:60,y:350,ht:450}]}},exports.Line=Line,exports.Radar=Radar;
