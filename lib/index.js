"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var React=_interopDefault(require("react"));function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function styleInject(e,t){void 0===t&&(t={});var a=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===a&&r.firstChild?r.insertBefore(n,r.firstChild):r.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}}var css=".radar_all {\n  position: relative;\n  width: 400px;\n  height: 400px;\n}\n.radar_canvas {\n  position: absolute;\n  top: 0;\n  left: 0;\n  border: 1px solid #000;\n}\n";styleInject(css);var Radar=function(e){function a(e){var t;return _classCallCheck(this,a),(t=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,e))).state={canvasId:["back","data"],lengthLimit:3,center:{},props:{}},t}return _inherits(a,React.Component),_createClass(a,[{key:"getCtx",value:function(e){return this.refs[e]&&this.refs[e].getContext("2d")}},{key:"componentDidMount",value:function(){var e=this;this.setState({props:this.props},function(){return e.init()})}},{key:"componentWillReceiveProps",value:function(e){var t=this;this.setState({props:e},function(){return t.init()})}},{key:"init",value:function(){var e=this,t=this.state.canvasId,a=this.state.props,r=a.width,n=a.height,i=this.getCtx(t[0]),o={x:Math.round(r/2),y:Math.round(n/2)};this.setState({center:o},function(){e.drawBack(i)})}},{key:"drwaCenterDot",value:function(e){var t=this.state.center;e.save(),e.beginPath(),e.translate(t.x,t.y),e.arc(0,0,3,0,2*Math.PI),e.fillStyle="#000",e.fill(),e.closePath(),e.stroke(),e.restore()}},{key:"drawRadar",value:function(e,t){var a,r,n=this.state.center,i=this.state.props,o=i.data,s=(i.width,i.height,i.radius),l=i.scaleLine,c=i.guideLine,u=l.lineWidth,h=l.lineColor,d=c.print,f=2*Math.PI/o.length,p=[],y=[],v=s<=t;e.save(),e.beginPath(),e.translate(n.x,n.y),e.moveTo(0,-t);for(var m=0;m<o.length;m++)a=-t*Math.sin(f*m),r=-t*Math.cos(f*m),this.drawLine(e,a,r),v&&(this.drawLabel(e,a,r,o[m]),p.push({x:a,y:r}),y.push({x:a,y:r,item:o[m]}));e.lineWidth=u,e.strokeStyle=h,e.closePath(),e.stroke(),e.restore(),v&&d&&this.drawGuideLine(e,p),v&&this.drawData(y)}},{key:"drawLine",value:function(e,t,a){e.lineTo(t,a)}},{key:"drawLabel",value:function(e,t,a,r){var n=this.state.props,i=(n.data,n.labelRender),o=i.label,s=(i.value,i.color),l=i.textGap,c=i.defaultColor,u=i.font,h=i.render;o=r[o]||"",s=r[s]||c,0<(t=Math.round(t))?t+=l:t<0&&(t-=l),0<(a=Math.round(a))?a+=l:a<0&&(a-=l),e.font=u,e.textAlign="center",e.fillStyle=s,e.fillText("function"==typeof h&&h(r,i)?h(r,i):o,t,a)}},{key:"drawGuideLine",value:function(e,t){for(var a=this.state.center,r=this.state.props.guideLine,n=r.dash,i=r.setLineDash,o=r.strokeStyle,s=r.lineWidth,l=0;l<t.length;l++)e.save(),e.beginPath(),e.translate(a.x,a.y),n&&e.setLineDash(i),e.moveTo(0,0),e.lineTo(t[l].x,t[l].y),e.lineWidth=s,e.strokeStyle=o,e.stroke(),e.restore()}},{key:"drawData",value:function(e){for(var t,a=this.state,r=a.canvasId,n=a.center,i=this.state.props,o=i.data,s=i.labelRender,l=i.dataRender,c=s.value,u=l.dash,h=l.stroke,d=l.fill,f=l.strokeStyle,p=l.lineWidth,y=l.fillStyle,v=l.setLineDash,m=this.getCtx(r[1]),g=[],b=function(e,t){return!isNaN(e)&&!isNaN(t)&&0<=e&&0<=t?e/t:0},_=0;_<o.length;_++)isNaN(o[_][c])||g.push(o[_][c]);t=Math.max.apply(null,g),m.save(),m.beginPath(),m.translate(n.x,n.y),m.moveTo(e[0].x*b(e[0].item[c],t),e[0].y*b(e[0].item[c],t));for(var k=0;k<e.length;k++)m.lineTo(e[k].x*b(e[k].item[c],t),e[k].y*b(e[k].item[c],t));m.closePath(),u&&m.setLineDash(v),h&&(m.strokeStyle=f,m.lineWidth=p,m.stroke()),d&&(m.fillStyle=y,m.fill()),m.restore()}},{key:"drawBack",value:function(e){var t=this.state.lengthLimit,a=this.state.props,r=a.data,n=a.width,i=a.height,o=a.radius,s=(a.lineWidth,a.scaleLine.gridNum);if(e.clearRect(0,0,n,i),r.length>=t){for(var l=0;l<s;l++)this.drawRadar(e,o-o/s*l);this.drwaCenterDot(e)}}},{key:"render",value:function(){var e=this.state.canvasId,t=this.state.props,a=t.width,r=t.height;return React.createElement("div",{className:"radar_all"},e&&e.map(function(e,t){return React.createElement("canvas",{key:e,ref:e,width:a,height:r,className:"radar_canvas"})}))}}]),a}();Radar.defaultProps={width:400,height:400,radius:120,scaleLine:{lineWidth:3,lineColor:"#5d9cec",gridNum:3},guideLine:{print:!0,dash:!0,setLineDash:[5,5],lineWidth:2,strokeStyle:"#5d9"},labelRender:{label:"name",value:"score",color:"color",textGap:12,defaultColor:"#000",font:"16px Arial",render:function(e,t){return"".concat(e[t.label]||"").concat(isNaN(e[t.value])?"":"("+e[t.value]+")")}},dataRender:{dash:!1,stroke:!1,fill:!0,setLineDash:[2,2],strokeStyle:"#000",lineWidth:1,fillStyle:"rgba(225, 225, 0, .9)"},data:[{name:"A",score:100,color:"aqua"},{name:"B",score:90,color:"red"},{name:"C",score:70},{name:"D",score:180,color:"blue"},{name:"E",score:80},{name:"F",score:40},{name:"G",score:-100},{name:"H",score:150}]},exports.Radar=Radar;
